name: API Tests - Crear Issues en GitHub

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  run-api-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: 20
        
    - name: ğŸ“¦ Instalar Dependencias
      run: npm install
      
    - name: âš™ï¸ Instalar Playwright
      run: npx playwright install --with-deps
      
    # PASO CRÃTICO: Ejecutar las pruebas con el Token de GitHub
    - name: ğŸš€ Ejecutar Pruebas y Crear Issues
      # Este token es AUTOMÃTICO y tiene permisos para crear issues en tu repo.
      # Usaremos el token integrado de GitHub, que es mÃ¡s seguro que un token personal.
      env:
        API_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
        # Si tienes el token como Secret llamado API_TOKEN, Ãºsalo aquÃ­:
        # API_TOKEN: ${{ secrets.API_TOKEN }} 
        
      run: npx playwright test --project="API Tests"
